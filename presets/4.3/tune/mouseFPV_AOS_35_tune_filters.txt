#$ TITLE:  AOS 3.5 V1 4s Tune | mouseFPV
#$ FIRMWARE_VERSION: 4.3
#$ CATEGORY: TUNE
#$ STATUS: EXPERIMENTAL
#$ KEYWORDS: AOS, 4s
#$ AUTHOR: mouseFPV
#$ PARSER: MARKED
#$ DESCRIPTION: <br>
#$ DESCRIPTION: <img src="https://user-images.githubusercontent.com/19867640/174462482-28bdcfec-1c3a-43db-99d7-50688b92f050.svg" width="100px" style="margin-left: auto; margin-right: auto; display: block;"/>
#$ DESCRIPTION:
#$ DESCRIPTION: Tune for AOS 3.5
#$ DESCRIPTION: ----------
#$ DESCRIPTION:
#$ DESCRIPTION: About:
#$ DESCRIPTION: ----------
#$ DESCRIPTION: * May be approproiate for v2 frame and/or different motors/cell counts
#$ DESCRIPTION: * Tune/Filters are aggressive, and may not be approproiate for non trussed/braced frames
#$ DESCRIPTION: * Recommended 48k PWM
#$ DESCRIPTION: * Defaults to DShot600. Using DShot on Unsupported ESC's is Dangerous. See Warning.
#$ DESCRIPTION:
#$ DESCRIPTION: Options:
#$ DESCRIPTION: ----------
#$ DESCRIPTION: * **Use DShot300:** Should be used on F4 Flight controllers, as well as manually setting a 4k PID Loop
#$ DESCRIPTION: * **Dynamic Idle:** Enables Dynamic Idle for Freestyle 3.5"
#$ DESCRIPTION: * **95% Motor Limit:** Takes some of the spice out of powerful motors on 4s
#$ DESCRIPTION: * **Enable Battery Sag Compensation:** Self Explanatory (see tooltip). Land at 3.5v/Cell or it's a bad time.
#$ DESCRIPTION: * **Filters -> Include RPM Filter (F7):** Enables bi-directional dshot, sets motor poles to 12, and applies approproiate filter settings with no Gyro Lowpass
#$ DESCRIPTION: * **Filters -> Include RPM Filter (F4):** Enables bi-directional dshot, sets motor poles to 12, and applies approproiate filter settings with Gyro LPF2 enabled. (F4 should use 4k PID loop and DShot300)
#$ DESCRIPTION:
#$ DESCRIPTION: Build Specs This Was Created on:
#$ DESCRIPTION: ----------
#$ DESCRIPTION: * **Frame:** AOS 3.5 V1
#$ DESCRIPTION: * **Motors:** FPVCycle 16mm (4s 95% Motor Limit)
#$ DESCRIPTION: * **FC/ESC:** Foxeer Reaper f7 AIO
#$ DESCRIPTION: * **AUW:** 243g
#$ DESCRIPTION:
#$ DESCRIPTION: Fly Like mouseFPV | Recommendations outside of tune:
#$ DESCRIPTION: ----------
#$ DESCRIPTION: * Apply mouseFPV Freestyle Rates
#$ DESCRIPTION: * Set Jitter Reduction (feedforward_jitter_factor) to 14
#$ DESCRIPTION:
#$ DISCUSSION: https://github.com/betaflight/firmware-presets/pull/247
#$ WARNING: Included Filters set motor poles to 12! Filters Require RPM filtering and DShot telemetry! This tune sets ESC protocol to DSHOT, it is extremely unsafe to even select it if your ESC does not support DSHOT (can spin the motors without arming)
#$ DISCLAIMER: Flash At Your Own Risk! This tune sets ESC protocol to DSHOT! See Warning!
#$ FORCE_OPTIONS_REVIEW: TRUE
#$ INCLUDE: presets/4.3/tune/defaults.txt

# ------- End Defaults --------
# ----- Begin Mouse Tune-------

set motor_pwm_protocol = DSHOT600

# -- PID Sliders  --
set simplified_pids_mode = RPY
set simplified_d_gain = 130
set simplified_pi_gain = 100
set simplified_feedforward_gain = 60
set simplified_dmax_gain = 000
set simplified_i_gain = 80
set simplified_pitch_d_gain = 105
set simplified_pitch_pi_gain = 105
set simplified_master_multiplier = 145
simplified_tuning apply

# -- iTerm relax --
set iterm_relax = RP
set iterm_relax_type = SETPOINT
set iterm_relax_cutoff = 10

# -- TPA  --
set tpa_rate = 70

# -- Antigravity --
set anti_gravity_gain = 3500

# -- Thrust linear --
set thrust_linear = 20

# -- DShot Idle (default)--
# Commonly set lower when dynamic idle is active.
set dshot_idle_value = 400

# -- Dyn Idle (off, default) --
set dyn_idle_min_rpm = 0


# ------ OPTIONS GO BELOW THIS LINE ------
# This is where the author includes options that require input from the User

#$ OPTION_GROUP BEGIN: General Options (Choose Many or None)

#$ OPTION BEGIN (CHECKED): Dynamic Idle
set dshot_bidir = ON
set dshot_idle_value = 150
set dyn_idle_min_rpm = 25
set dyn_idle_p_gain = 50
#$ OPTION END

#$ OPTION BEGIN (UNCHECKED): Use DShot300?
set motor_pwm_protocol = DSHOT300
#$ OPTION END

#$ OPTION BEGIN (UNCHECKED): 95% Motor Limit? (Use this if its too spicy)
set motor_output_limit = 95
#$ OPTION END

#$ OPTION BEGIN (UNCHECKED): Enable Battery Sag Compensation?
set vbat_sag_compensation = 100
#$ OPTION END

#$ OPTION_GROUP END

#$ OPTION_GROUP BEGIN: Filters (Choose One or None)

#$ OPTION BEGIN (Unchecked): Include RPM Filter (F7)? (Dshot600 8k PID Loop Strongly Recommended)
#$ INCLUDE: presets/4.3/filters/defaults.txt

# ------- End Defaults --------
# ----- Begin Mouse Tune-------

# enable dshot rpm telemetry
set dshot_bidir = ON
set motor_poles = 12

# -- Gyro lowpass filters --
# -- No Gyro Lowpass
set gyro_lpf1_static_hz = 0
set gyro_lpf1_dyn_min_hz = 0
set gyro_lpf1_dyn_max_hz = 0
set gyro_lpf2_static_hz = 0
set simplified_gyro_filter = off

# -- Gyro Dynamic Notches --
set dyn_notch_count = 1
set dyn_notch_q = 500
set dyn_notch_min_hz = 150
set dyn_notch_max_hz = 600

# -- RPM filtering --
set rpm_filter_q = 500
set rpm_filter_min_hz = 125
set rpm_filter_harmonics = 3

# -- Dterm filtering --
set dterm_lpf1_dyn_min_hz = 93
set dterm_lpf1_dyn_max_hz = 187
set dterm_lpf1_dyn_expo = 5
set dterm_lpf1_static_hz = 93
set dterm_lpf2_static_hz = 187
set simplified_dterm_filter = on
set simplified_dterm_filter_multiplier = 125

# -- Yaw lowpass --
set yaw_lowpass_hz = 100
#$ OPTION END

#$ OPTION BEGIN (Unchecked): Include RPM Filter (F4)? (Dshot300 and 4k PID Loop Strongly Recommended)
#$ INCLUDE: presets/4.3/filters/defaults.txt

# ------- End Defaults --------
# ----- Begin Mouse Tune-------

# enable dshot rpm telemetry
set dshot_bidir = ON
set motor_poles = 12

# -- Gyro lowpass filters --
set gyro_lpf1_static_hz = 0
set gyro_lpf1_dyn_min_hz = 0
set gyro_lpf1_dyn_max_hz = 0
set gyro_lpf2_static_hz = 1000
set simplified_gyro_filter_multiplier = 200
set simplified_gyro_filter = on

# -- Gyro Dynamic Notches --
set dyn_notch_count = 1
set dyn_notch_q = 500
set dyn_notch_min_hz = 150
set dyn_notch_max_hz = 600

# -- RPM filtering --
set rpm_filter_q = 500
set rpm_filter_min_hz = 125
set rpm_filter_harmonics = 3

# -- Dterm filtering --
set dterm_lpf1_dyn_min_hz = 93
set dterm_lpf1_dyn_max_hz = 187
set dterm_lpf1_dyn_expo = 5
set dterm_lpf1_static_hz = 93
set dterm_lpf2_static_hz = 187
set simplified_dterm_filter = on
set simplified_dterm_filter_multiplier = 125


# -- Yaw lowpass --
set yaw_lowpass_hz = 100
#$ OPTION END


#$ OPTION_GROUP END